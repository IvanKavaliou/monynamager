<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="fragments/general :: header"/>
</head>
<body>
<th:block th:insert="fragments/header :: header" />
<div class="row justify-content-center">
    <div class="col col-md-3">
        <div class="container">
            <div>
                <div class="container">
                    <div class="row">
                        <div class="col">
                            <h6>[[#{label.choiseCurrency}]]</h6>
                        </div>
                        <div class="col-5">
                            <select id="currencySelect" class="nice-select custom-select custom-select-sm">
                                <option th:each="currency : ${user.getUserCurrencys()}" th:value="${currency.currencyType}" th:text= "#{label.currency. + ${currency.currencyType}}"></option>
                            </select>
                        </div>
                        <div class="col-1">
                            <button type="button" class="btn btn-light btn-sm">+</button>
                        </div>
                        <div class="col-1">
                            <button type="button" id="currencyDelete" class="btn btn-light btn-sm"  data-toggle="modal" data-target="#deleteCurrencyModal">-</button>
                        </div>
                    </div>
                    <div class="row">
                        <div id="currencyMessageAlert" class="alert alert-primary alert-dismissible collapse" role="alert">
                            <div id="currencyMessage"></div>
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-2">
                <div class="container">
                    <div class="row">
                        <div class="col"><h3>[[#{label.expenses}]]</h3></div>
                        <div class="col"><button type="button" data-id="EXPESES" class="btn btn-light btn-sm open-AddDialog" data-toggle="modal" data-target="#addModal">+</button></div>
                    </div>
                    <div class="row ml-1">
                        <div class="col"><h6>[[#{label.today}]]</h6></div>
                        <div id="expenses_day" class="col"><h6>~~~~</h6></div>
                    </div>
                    <div class="row ml-1">
                        <div class="col"><h6>[[#{label.week}]]</h6></div>
                        <div id="expenses_week" class="col"><h6>~~~~</h6></div>
                    </div>
                    <div class="row ml-1">
                        <div class="col"><h6>[[#{label.mounth}]]</h6></div>
                        <div id="expenses_month" class="col"><h6>~~~~</h6></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="container">
                    <div class="row">
                        <div class="col"><h3>[[#{label.income}]]</h3></div>
                        <div class="col"><button type="button" data-id="INCOME" class="btn btn-light btn-sm open-AddDialog" data-toggle="modal" data-target="#addModal">+</button></div>
                    </div>
                    <div class="row ml-1">
                        <div class="col"><h6>[[#{label.today}]]</h6></div>
                        <div id="income_day" class="col"><h6>~~~~</h6></div>
                    </div>
                    <div class="row ml-1">
                        <div class="col"><h6>[[#{label.week}]]</h6></div>
                        <div id="income_week" class="col"><h6>~~~~</h6></div>
                    </div>
                    <div class="row ml-1">
                        <div class="col"><h6>[[#{label.mounth}]]</h6></div>
                        <div id="income_month" class="col"><h6>~~~~</h6></div>
                    </div>
                </div>
            </div>
            <div>
                <div class="container">
                    <div class="row">
                        <div class="col"><h3>[[#{label.balance}]]</h3></div>
                    </div>
                    <div class="row">
                        <div id="balance" class="col"><h4>~~~~</h4></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-auto">
        <div class="container">
            <div>
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a role="tab" data-toggle="tab" class="nav-link active" href="#tab-1">[[#{label.last}]]</a></li>
                    <li class="nav-item"><a role="tab" data-toggle="tab" class="nav-link" href="#tab-2">[[#{label.expenses}]]</a></li>
                    <li class="nav-item"><a role="tab" data-toggle="tab" class="nav-link" href="#tab-3">[[#{label.income}]]</a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="tab-1">
                        <table id="lastTable" class="display" style="width: 100%">
                            <thead>
                            <tr>
                                <th>[[#{label.date}]]</th>
                                <th>[[#{label.description}]]</th>
                                <th>[[#{label.value}]]</th>
                                <th>[[#{label.currency}]]</th>
                                <th>[[#{label.category}]]</th>
                                <th>[[#{label.type}]]</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="tab-2">
                        <table id="expensesTable" class="display" style="width: 100%">
                            <thead>
                            <tr>
                                <th>[[#{label.date}]]</th>
                                <th>[[#{label.description}]]</th>
                                <th>[[#{label.value}]]</th>
                                <th>[[#{label.currency}]]</th>
                                <th>[[#{label.category}]]</th>
                                <th>[[#{label.type}]]</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="tab-3">
                        <table id="incomeTable" class="display" style="width: 100%">
                            <thead>
                            <tr>
                                <th>[[#{label.date}]]</th>
                                <th>[[#{label.description}]]</th>
                                <th>[[#{label.value}]]</th>
                                <th>[[#{label.currency}]]</th>
                                <th>[[#{label.category}]]</th>
                                <th>[[#{label.type}]]</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- DELETE CURRENCY MODAL-->
<div class="modal fade" id="deleteCurrencyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteCurrencyModalTitle">[[#{currency.delete.title}]]</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                [[#{currency.delete.message}]]
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">[[#{button.close}]]</button>
                <button type="button" id="currencyDeleteSubmit" class="btn btn-primary">[[#{button.delete}]]</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="login-clean">
                    <form th:action="@{/registration}" method="post">
                        <div class="form-group">
                            <h6>[[#{label.description}]]</h6>
                            <input type="email" class="form-control" th:classappend="${descriptionError}? 'is-invalid'" name="description" th:placeholder="#{label.email}" />
                            <div th:if="${descriptionError}" class="invalid-feedback">[[#{${descriptionError}}]]</div>
                        </div>
                        <div class="form-group">
                            <h6>[[#{label.currency}]]</h6>
                            <select id="currencySelectAdd" class="nice-select custom-select custom-select-sm">
                                <option th:each="currency : ${user.getUserCurrencys()}" th:value="${currency}" th:text= "#{label.currency. + ${currency.currencyType}}"></option>
                            </select>
                        </div>
                        <div class="form-group">
                            <h6>[[#{label.value}]]</h6>
                            <input type="number" class="form-control" th:classappend="${valueError}? 'is-invalid'" name="value" th:placeholder="#{label.email}" />
                            <div th:if="${valueError}" class="invalid-feedback">[[#{${valueError}}]]</div>
                        </div>
                        <div class="form-group">
                            <h6>[[#{label.currency}]]</h6>
                            <select id="categorys" class="nice-select custom-select custom-select-sm">
                                <option th:each="category : ${expensesCategorys}" th:value="${category}" th:text= "${category.getName()}"></option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button"  class="btn btn-primary">Save changes</button>
            </div>
        </div>
</div>
</div>


<script>

    $(document).on("click", ".open-AddDialog", function () {
        var myId = $(this).data('id');
      //  $(".modal-body #bookId").val( myBookId );
        // As pointed out in comments,
        // it is unnecessary to have to manually call the modal.
        // $('#addBookDialog').modal('show');
    });

    $('#currencySelect').change(function() {
        upAmounts($('#currencySelect').val());
    });

    function upAmounts(currency){
        $.ajax({
            url: "http://localhost:8080/rest/amount/INCOME/" + currency
        }).then(function(data) {
            $('#income_day').html(data.day);
            $('#income_week').html(data.week);
            $('#income_month').html(data.month);
            $('#balance').html(data.balance);
        });

        $.ajax({
            url: "http://localhost:8080/rest/amount/EXPENSES/" + currency
        }).then(function(data) {
            $('#expenses_day').html(data.day);
            $('#expenses_week').html(data.week);
            $('#expenses_month').html(data.month);
        });
    }

    $(document).ready( function () {
        var table = $('#lastTable').DataTable({
            language: {
                url: "/dt_i18n/[[${#locale}]].lang"
            },
            "sAjaxSource": "rest/trnsactions",
            "sAjaxDataProp": "",
            "order": [ [ 0, "asc" ] ],
            "aoColumns": [
                { "data": "date"},
                { "data": "name" },
                { "data": "value" },
                { "data": "currency.currencyType"},
                { "data": "transactionCategory.name"},
                { "data": "transactionCategory.transactionType.transactionType"}
            ]
        });

        var tableIncome = $('#incomeTable').DataTable({
            language: {
                url: "/dt_i18n/[[${#locale}]].lang"
            },
            "sAjaxSource": "rest/trnsactions/income",
            "sAjaxDataProp": "",
            "order": [ [ 0, "asc" ] ],
            "aoColumns": [
                { "data": "date"},
                { "data": "name" },
                { "data": "value" },
                { "data": "currency.currencyType"},
                { "data": "transactionCategory.name"},
                { "data": "transactionCategory.transactionType.transactionType"}
            ]
        });

        var tableExpenses = $('#expensesTable').DataTable({
            language: {
                url: "/dt_i18n/[[${#locale}]].lang"
            },
            "sAjaxSource": "rest/trnsactions/expenses",
            "sAjaxDataProp": "",
            "order": [ [ 0, "asc" ] ],
            "aoColumns": [
                { "data": "date"},
                { "data": "name" },
                { "data": "value" },
                { "data": "currency.currencyType"},
                { "data": "transactionCategory.name"},
                { "data": "transactionCategory.transactionType.transactionType"}
            ]
        });

        upAmounts($('#currencySelect').val());

        $("#currencyDelete").click(function(){
            var cur = $('#currencySelect option:selected').html();
            $("#deleteCurrencyModalTitle").html('[[#{currency.delete.title}]] ('+ cur +')');
        });

        $("#currencyDeleteSubmit").click(function(){
            $.ajax({
                url: '/currency/delete/' + $('#currencySelect').val(),
                type: 'GET',
                success: function(result) {
                    $('#deleteCurrencyModal').modal('toggle');
                },
                error: function (result) {
                    $('#deleteCurrencyModal').modal('toggle');
                    $("#currencyMessageAlert").show();
                    $("#currencyMessage").html(result.responseJSON.message);
                }
            });
        });

    });



</script>

<th:block th:insert="fragments/general :: footer"/>
</body>
</html>